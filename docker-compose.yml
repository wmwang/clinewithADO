---
# =============================================================================
# Cline CLI + Azure DevOps - Docker Compose
# =============================================================================
# Usage:
#   1. Copy .env.example to .env and fill in your credentials
#   2. docker compose run --rm cline                   # interactive session
#   3. docker compose run --rm cline -y "fix tests"    # headless task
# =============================================================================

services:
  cline:
    image: ${DOCKER_IMAGE:-your-org/cline-ado}:${IMAGE_TAG:-latest}
    # To build locally instead of pulling:
    # build:
    #   context: .
    #   args:
    #     CLINE_VERSION: "2.5.0"

    environment:
      # ── AI Provider (OpenAI-compatible) ──────────────────────────────────────
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      # - OPENAI_BASE_URL=${OPENAI_BASE_URL:-}   # Azure OpenAI / Ollama / vLLM
      # - CLINE_MODEL=${CLINE_MODEL:-gpt-4o}

      # ── Corporate Proxy (optional) ───────────────────────────────────────────
      # - HTTPS_PROXY=${HTTPS_PROXY:-}
      # - HTTP_PROXY=${HTTP_PROXY:-}
      # - NO_PROXY=${NO_PROXY:-}

      # ── Azure DevOps ─────────────────────────────────────────────────────────
      - ADO_ORG=${ADO_ORG}
      - ADO_MCP_AUTH_TOKEN=${ADO_MCP_AUTH_TOKEN}

    volumes:
      # Mount your project as the working directory
      - .:/workspace

      # Persist Cline config across sessions
      - cline-data:/home/node/.cline/data

    working_dir: /workspace

    # Required for Cline's interactive TUI
    stdin_open: true
    tty: true

volumes:
  cline-data:
    driver: local
